{"version":3,"sources":["fetch.js"],"names":["fetch","require","GFT","FETCH_ID","getID","activeFetches","removeFetch","sig","type","splice","indexOf","id","isActive","includes","undefined","ABORTED_FETCH","ABORT_FETCH_FAILED","INCREMENT_FETCH","DECREMENT_FETCH","FETCH","FETCH_MULTIPLE","FETCH_ERROR","createAction","payload","fetchAction","fetchMultiple","abortedFetch","abortFetchFailed","fetchError","abortFetch","decrementFetches","abortAllFetches","Object","keys","reduce","aborts","fetchType","map","incrementFetches","actions","push","signature","middleware","store","next","action","dispatch","runFetchAction","getState","runFetchMultiple","runFetch","state","options","retry","url","headers","createAuthorizationHeader","createContentHeader","body","filteredHeaders","filter","key","forEach","serialize","then","checkStatus","createResponse","response","dispatchFetchError","length","wrappedNext","wrapNext","catch","error","createErrorResponse","fetches","Promise","all","responses","user","idToken","Authorization","res","status","window","FormData","resolve","deserialize","value","err","header","get","json","arrayBuffer","text","JSON","stringify"],"mappings":"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","sourcesContent":["// @flow\nimport get from 'lodash/get'\nimport isObject from 'lodash/isObject'\nif (typeof (fetch) === 'undefined') {\n  require('isomorphic-fetch')\n}\n\n// Generic fetch type\nconst GFT = '__FETCH__'\n\n// ID that gets incremented for each fetch\nlet FETCH_ID = 0\n\n// Get's the next fetch ID, which can be passed in to `fetch`, and allows for\n// tracking the fetch or aborting it.\nexport const getID = () => ++FETCH_ID\n\n// Active fetches, can still be aborted\nconst activeFetches = {\n  [GFT]: []\n}\n\n// Remove a fetch from the active pool\nconst removeFetch = (sig) => {\n  if (sig.type === GFT) {\n    activeFetches[GFT].splice(activeFetches[GFT].indexOf(sig.id), 1)\n  } else {\n    delete activeFetches[sig.type]\n  }\n}\n\n// Check if a fetch is still active\nexport const isActive = (sig) => {\n  if (sig.type === GFT) return activeFetches[GFT].includes(sig.id)\n  if (activeFetches[sig.type] === undefined) return false\n  if (sig.id === undefined) return true\n  return activeFetches[sig.type] === sig.id\n}\n\n// Action types\nexport const ABORTED_FETCH = 'aborted fetch'\nexport const ABORT_FETCH_FAILED = 'abort fetch failed'\nexport const INCREMENT_FETCH = 'increment outstanding fetches'\nexport const DECREMENT_FETCH = 'decrement outstanding fetches'\nexport const FETCH = 'fetch'\nexport const FETCH_MULTIPLE = 'fetch multiple'\nexport const FETCH_ERROR = 'fetch error'\n\n// Simple action creator\nconst createAction = (type) => (payload) => ({type, payload})\n\n// Main actions to be dispatched\nexport const fetchAction = createAction(FETCH)\nexport const fetchMultiple = createAction(FETCH_MULTIPLE)\nexport default fetchAction\n\n// Internally dispatched actions\nconst abortedFetch = createAction(ABORTED_FETCH)\nconst abortFetchFailed = createAction(ABORT_FETCH_FAILED)\nconst fetchError = createAction(FETCH_ERROR)\n\n/**\n * Call decrement and dispatch \"aborted\" and \"decrement\" actions. If `id` is\n * not set, cancel all fetches for the given type.\n */\nexport const abortFetch = (sig) => {\n  if (isActive(sig)) {\n    return [\n      abortedFetch(sig),\n      decrementFetches(sig)\n    ]\n  } else {\n    return abortFetchFailed(sig)\n  }\n}\n\n// Abort all active fetches\nexport const abortAllFetches = () =>\n  Object.keys(activeFetches).reduce((aborts, fetchType) => {\n    if (fetchType === GFT) {\n      return [\n        ...aborts,\n        ...activeFetches[GFT].map(id => abortFetch({type: GFT, id}))\n      ]\n    } else {\n      return [\n        ...aborts,\n        abortFetch({type: fetchType, id: activeFetches[fetchType]})\n      ]\n    }\n  }, [])\n\n/**\n * Send an increment action and add the fetch to the active list. This will also\n * abort a previous fetch of the same type if it exists.\n */\nconst incrementFetches = (payload) => {\n  const actions = [{\n    type: INCREMENT_FETCH,\n    payload\n  }]\n\n  if (payload.type === GFT) activeFetches[GFT].push(payload.id)\n  else {\n    if (activeFetches[payload.type] !== undefined) {\n      actions.push(abortFetch({\n        type: payload.type,\n        id: activeFetches[payload.type]\n      }))\n    }\n    activeFetches[payload.type] = payload.id\n  }\n\n  return actions\n}\n\n/**\n * Send a decrement action and remove the fetch from the active list.\n */\nconst decrementFetches = (signature) => {\n  removeFetch(signature)\n\n  return {\n    type: DECREMENT_FETCH,\n    payload: signature\n  }\n}\n\n// Redux middleware\nexport const middleware = (store) => (next) => (action) => {\n  switch (get(action, 'type')) {\n    case FETCH:\n      return store.dispatch(runFetchAction(action.payload, store.getState()))\n    case FETCH_MULTIPLE:\n      return store.dispatch(runFetchMultiple(action.payload, store.getState()))\n    default:\n      return next(action)\n  }\n}\n\n/**\n * Calls fetch, adds Auth and Content header if needed. Automatically parses\n * content based on type.\n *\n * @returns Promise\n */\nfunction runFetch ({\n  signature,\n  options = {},\n  retry = false,\n  url\n}, state) {\n  const headers = {\n    ...createAuthorizationHeader(state),\n    ...createContentHeader(options.body),\n    ...(options.headers || {})\n  }\n\n  const filteredHeaders = {}\n\n  // Allow removing generated headers by specifiying { header: null } in\n  // options.headers. Do this in two steps because otherwise we're modifying\n  // the object as we're iterating over it.\n  Object.keys(headers)\n    .filter(key => headers[key] !== null && headers[key] !== undefined)\n    .forEach(key => { filteredHeaders[key] = headers[key] })\n\n  return fetch(url, {\n    ...options,\n    body: serialize(options.body),\n    headers: filteredHeaders\n  })\n    .then(checkStatus)\n    .then(createResponse)\n    .then(async (response) =>\n      (retry && isActive(signature) && await retry(response))\n        ? runFetch({signature, options, retry, url}, state)\n        : response)\n}\n\n/**\n * Part of Redux action cycle. Returns an array of actions.\n */\nfunction runFetchAction ({\n  type = GFT,\n  id = getID(),\n  next,\n  options = {},\n  retry = false,\n  url\n}, state) {\n  // Fetch signature based on the `type` and `id`\n  const signature = {type, id}\n\n  // If next does not exist or only takes a response, dispatch on error\n  const dispatchFetchError = !next || next.length < 2\n\n  // Wrap next so that we can parse the response\n  const wrappedNext = wrapNext(next)\n\n  return [\n    incrementFetches({type, id, options, url}),\n    runFetch({signature, options, retry, url}, state)\n      .then((response) => {\n        if (isActive(signature)) {\n          return [\n            decrementFetches(signature),\n            wrappedNext(null, response)\n          ]\n        }\n      })\n      .catch((error) => {\n        return createErrorResponse(error)\n          .then((response) => {\n            if (isActive(signature)) {\n              const actions = [\n                decrementFetches(signature),\n                wrappedNext(error, response)\n              ]\n              if (dispatchFetchError) actions.push(fetchError(response))\n              return actions\n            }\n          })\n      })\n  ]\n}\n\n/**\n * @returns Array of actions\n */\nfunction runFetchMultiple ({\n  type = GFT,\n  id = getID(), // One ID for all fetch IDs in a fetch multiple\n  fetches,\n  next\n}, state) {\n  const signature = {type, id}\n  const dispatchFetchError = !next || next.length < 2\n  const wrappedNext = wrapNext(next)\n\n  return [\n    incrementFetches({type, id, fetches}),\n    Promise.all(fetches.map((fetch) => runFetch({...fetch, signature}, state)))\n      .then((responses) => {\n        if (isActive(signature)) {\n          return [\n            decrementFetches(signature),\n            wrappedNext(null, responses)\n          ]\n        }\n      })\n      .catch((error) =>\n        createErrorResponse(error)\n          .then((response) => {\n            if (isActive(signature)) {\n              const actions = [\n                decrementFetches(signature),\n                wrappedNext(error, response)\n              ]\n              if (dispatchFetchError) actions.push(fetchError(response))\n              return actions\n            }\n          }))\n  ]\n}\n\n/**\n * TODO: Expose this function to allow for customization.\n */\nfunction createAuthorizationHeader (state) {\n  return state.user && state.user.idToken\n    ? {Authorization: `bearer ${state.user.idToken}`}\n    : {}\n}\n\nfunction checkStatus (res) {\n  if (res.status >= 200 && res.status < 300) {\n    return res\n  } else {\n    throw res\n  }\n}\n\nfunction createContentHeader (body) {\n  if (body instanceof window.FormData) {\n    return {}\n  } else if (isObject(body)) {\n    return {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json;charset=UTF-8'\n    }\n  } else {\n    return {}\n  }\n}\n\nfunction createErrorResponse (res) {\n  return res.headers\n    ? createResponse(res)\n    : Promise.resolve(res)\n}\n\nfunction createResponse (res) {\n  return deserialize(res)\n    .then((value) => {\n      res.value = value\n      return res\n    })\n    .catch((err) => {\n      res.value = err\n      return res\n    })\n}\n\nasync function deserialize (res) {\n  const header =\n    `${res.headers.get('Content-Type')} ${res.headers.get('Content')}`\n  if (header.indexOf('json') > -1) return res.json()\n  if (header.indexOf('octet-stream') > -1) return res.arrayBuffer()\n  if (header.indexOf('text') > -1) return res.text()\n}\n\nfunction serialize (body) {\n  if (body instanceof window.FormData) {\n    return body\n  } else if (isObject(body)) {\n    return JSON.stringify(body)\n  } else {\n    return body\n  }\n}\n\nfunction wrapNext (next) {\n  return function (error, response) {\n    if (next) {\n      if (next.length > 1) {\n        return next(error, response)\n      } else if (!error) {\n        return next(response)\n      }\n    }\n  }\n}\n"]}